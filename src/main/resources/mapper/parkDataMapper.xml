<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.park.public_gs.mapper.ParkDataMapper" >	<!-- mapper 인터페이스가 위치하는 경로 -->

    <!-- 이용 현황 신규 저장 -->
    <insert id="parkDataInsert" parameterType="org.park.public_gs.vo.ParkDataVo">
        INSERT INTO parkdata
        (serialNo, spaceNo, carNo, enterType, enterDate, enterUser, discountCode, leaveType,
         leaveDate, leaveUser, spotCount, userRemark, spotNo, gasan, discAmount, cutAmount, saleAmount,
         receiveAmount, recpDt, gojiState, remark, insertUser, insertDate, insertIp, del_Tag, chasu)
        VALUES
        (#{serialNo}, #{spaceNo}, #{carNo}, 3, #{enterDate}, #{enterUser}, #{discountCode}, #{leaveType},
         #{leaveDate}, #{leaveUser}, #{spotCount}, #{userRemark}, #{spotNo}, #{gasan}, #{discAmount}, #{cutAmount}, #{saleAmount},
         #{receiveAmount}, #{recpDt}, #{gojiState}, #{remark}, #{insertUser}, now(), #{insertIp}, 0, #{chasu})
    </insert>

    <!-- 이용 현황 전체 데이터 조회 -->
    <select id="getParkDataList" resultType="org.park.public_gs.dto.ParkStatusDto">
        SELECT p.serialNo, s.spaceNm, p.enterDate, p.leaveDate, p.carNo, p.recpDt, p.accGubun, p.saleAmount, p.discAmount, p.gasan
        FROM parkdata p
            JOIN space_info s
                ON p.spaceNo = s.spaceNo
        WHERE p.del_Tag = '0'
    </select>

    <!-- 이용 현황 검색 -->
    <select id="getParkDataSearchList" parameterType="org.park.public_gs.dto.ParkSearchDto" resultType="org.park.public_gs.dto.ParkStatusDto">
        SELECT s.spaceNm, p.enterDate, p.leaveDate, p.carNo, p.recpDt, p.accGubun, p.saleAmount, p.discAmount, p.gasan
        FROM parkdata p
            JOIN space_info s
                ON p.spaceNo = s.spaceNo
        <choose>
            <when test="carNo != null">
                p.carNo = #{carNo}
            </when>
            <otherwise>
                p.carNo = null;
            </otherwise>
        </choose>
        <choose>
            <when test="spaceNm != null">
                s.spaceNm = #{spaceNm}
            </when>
            <otherwise>
                s.spacenm = null;
            </otherwise>
        </choose>
        <choose>
            <when test="accGubun != null">
                s.accGubun = #{accGubun}
            </when>
            <otherwise>
                s.accGubun = null;
            </otherwise>
        </choose>
        WHERE p.enterDate LIKE '%' || #{enterDate} || '%'
        AND p.leaveDate LIKE '%' || #{outDate} || '%'
        AND p.del_Tag = '0'
    </select>

    <select id="getParkDataDetail" parameterType="String"  resultType="org.park.public_gs.dto.ParkDataDto">
        SELECT p.serialNo, s.spaceNm, p.spotNo, p.carNo, p.enterDate, p.enterUser, p.discountCode, p.leaveType, p.leaveDate,
               p.leaveUser, p.spotCount, p.userRemark, p.gasan, p.discAmount, p.cutAmount, p.saleAmount, p.receiveAmount, p.recpNo,
               p.recpDt, p.remark, p.accGubun, p.gojiState
        FROM parkdata p
                 JOIN space_info s
                      ON p.spaceNo = s.spaceNo
        WHERE p.serialNo = #{serialNo}
            AND p.del_Tag = '0'
    </select>

    <delete id="deleteParkData" parameterType="String">
        DELETE FROM parkdata
        WHERE serialNo = #{serialNo}
    </delete>

</mapper>